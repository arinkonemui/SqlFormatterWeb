<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SQL整形ツール（高速・無料・ブラウザだけ）</title>
  <meta name="description" content="SQLをブラウザだけでサッと整形。MySQL/PostgreSQL/SQLite/SQL Server対応。データ送信なし＆完全無料。" />
  <style>
    :root { --bg:#0f172a; --card:#111827; --muted:#94a3b8; --fg:#e5e7eb; --acc:#22d3ee; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:1100px;margin:0 auto;padding:24px}
    .title{font-size:24px;font-weight:800;letter-spacing:.5px}
    .card{background:var(--card);border:1px solid #1f2937;border-radius:14px;padding:16px;box-shadow:0 10px 30px rgb(0 0 0 / .25)}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .row > *{margin:4px 0}
    select, input[type="number"], input[type="checkbox"], input[type="text"]{background:#0b1220;border:1px solid #243045;color:var(--fg);border-radius:10px;padding:8px 10px}
    input[type="text"]{min-width:220px}
    textarea{width:100%;min-height:180px;background:#0b1220;border:1px solid #243045;border-radius:12px;color:var(--fg);padding:12px;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    .out{min-height:220px;white-space:pre;overflow:auto}
    .btn{background:#0b1220;border:1px solid #334155;color:var(--fg);padding:10px 14px;border-radius:10px;cursor:pointer}
    .btn:hover{border-color:#475569}
    .btn.primary{border-color:#0ea5b7;background:linear-gradient(180deg,#0ea5b7,#0b7782);font-weight:700}
    .btn.small{padding:6px 10px;border-radius:8px}
    .muted{color:var(--muted);font-size:13px}
    .footer{margin-top:18px;color:#9ca3af;font-size:12px}
    .badge{display:inline-block;padding:2px 8px;border:1px solid #334155;border-radius:999px;font-size:12px;color:#cbd5e1}
    .vstack{display:flex;flex-direction:column;gap:10px}
    .pill{display:inline-flex;align-items:center;gap:8px}
    .hint{font-size:12px;color:#a1a1aa}
    .danger{border-color:#ef4444 !important;color:#fecaca !important}
  </style>
  <!-- sql-formatter（UMD） -->
  <script src="https://unpkg.com/sql-formatter/dist/sql-formatter.min.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="row" style="justify-content:space-between">
      <div class="title">SQL整形ツール</div>
      <div class="badge">ローカル実行 / データ送信なし</div>
    </div>

    <div class="card" style="margin-top:14px">
      <!-- ツールバー -->
      <div class="row">
        <label>方言
          <select id="dialect">
            <option value="sql">Standard SQL</option>
            <option value="mysql">MySQL</option>
            <option value="postgresql">PostgreSQL</option>
            <option value="sqlite">SQLite</option>
            <option value="tsql">SQL Server (T-SQL)</option>
          </select>
        </label>
        <label>インデント
          <input id="indent" type="number" min="2" max="8" step="1" value="2" />
        </label>
        <label class="pill"><input id="uppercase" type="checkbox" /> キーワードを大文字に</label>

        <button class="btn primary" id="formatBtn">整形</button>
        <button class="btn" id="minifyBtn">ミニファイ</button>
        <button class="btn" id="copyBtn">コピー</button>
        <button class="btn" id="clearBtn">クリア</button>
      </div>

      <!-- タブ切替 -->
      <div class="row" style="margin-top:8px">
        <button class="btn" id="tabFormat">整形ツール</button>
        <button class="btn" id="tabBuilder">SQL作成</button>
      </div>

      <!-- SQLビルダー：複数行追加方式 -->
      <div id="builder" class="card" style="margin-top:12px; display:none">
        <!-- テーブル名 -->
        <div class="row">
          <label>テーブル名 <input id="b_table" type="text" placeholder="users" /></label>
        </div>

        <!-- カラム複数 -->
        <div style="margin-top:6px">
          <div class="row" style="justify-content:space-between">
            <div class="muted">カラム（複数可）</div>
            <div class="hint">空欄は無視／Enterで追加</div>
          </div>
          <div id="colsGrid" class="vstack" style="margin-top:6px"></div>
          <div class="row" style="margin-top:6px">
            <button class="btn small" id="addCol">＋ カラムを追加</button>
          </div>
        </div>

        <!-- 条件複数 -->
        <div style="margin-top:12px">
          <div class="row" style="justify-content:space-between">
            <div class="muted">条件（WHERE：複数可／AND結合）</div>
            <div class="hint">例：created_at >= '2025-01-01'</div>
          </div>
          <div id="condsGrid" class="vstack" style="margin-top:6px"></div>
          <div class="row" style="margin-top:6px">
            <button class="btn small" id="addCond">＋ 条件を追加</button>
          </div>
        </div>

        <!-- 並び順・件数 -->
        <div class="row" style="margin-top:12px">
          <label>並び順（ORDER BY） <input id="b_order" type="text" placeholder="created_at DESC"/></label>
          <label>件数（LIMIT） <input id="b_limit" type="number" min="1" placeholder="100" style="width:100px"/></label>
        </div>

        <!-- 生成 -->
        <div class="row" style="margin-top:8px">
          <button class="btn primary" id="b_make">SQLを作る → 入力に反映</button>
          <button class="btn danger small" id="b_clear">ビルダー入力をクリア</button>
        </div>

        <div class="muted" style="margin-top:8px">
          ※本機能は生成補助です。SQLの妥当性はご自身でご確認ください。
        </div>
      </div>

      <!-- 入出力 -->
      <div style="margin-top:10px">
        <div class="muted">入力（SQL）</div>
        <textarea id="input" placeholder="SELECT * from users where id=1 AND status='active' order by created_at desc;"></textarea>
      </div>

      <div style="margin-top:10px">
        <div class="muted">出力</div>
        <pre id="output" class="out"></pre>
      </div>

      <div class="footer">
        使い方：SQLをペースト → 「整形」。最小化したい場合は「ミニファイ」。<br/>
        免責：本ツールの利用によるいかなる損害も開発者は責任を負いません。
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="muted">プライバシー</div>
      このサイトは入力内容をサーバに送信しません。ブラウザ内でのみ処理します。広告を表示する場合、第三者のCookie等が利用されることがあります。
    </div>

    <!-- 広告（後で差し込み） -->
    <!-- 例：<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXX" crossorigin="anonymous"></script> -->
  </div>

  <script>
    const $ = (s)=>document.querySelector(s);
    const input = $('#input'), output = $('#output');
    const dialect = $('#dialect'), indent = $('#indent'), uppercase = $('#uppercase');

    function formatNow(){
      try{
        const sql = input.value || '';
        const opt = {
          language: dialect.value,
          tabWidth: Math.max(2, Math.min(8, Number(indent.value) || 2)),
          keywordCase: uppercase.checked ? 'upper' : 'preserve',
        };
        const res = window.sqlFormatter.format(sql, opt);
        output.textContent = res;
      }catch(e){
        output.textContent = '整形に失敗しました: ' + (e?.message||e);
      }
    }

    function minifyNow(){
      const sql = input.value || '';
      const noComments = sql.replace(/--.*?$|\/\*[\s\S]*?\*\//gm,'');
      const mini = noComments.replace(/\s+/g,' ').trim();
      output.textContent = mini;
    }

    // ツールバー
    $('#formatBtn').addEventListener('click', formatNow);
    $('#minifyBtn').addEventListener('click', minifyNow);
    $('#copyBtn').addEventListener('click', async ()=>{
      const text = output.textContent || '';
      try{ await navigator.clipboard.writeText(text);
           alert('コピーしました'); } catch{ alert('コピーに失敗しました'); }
    });
    $('#clearBtn').addEventListener('click', ()=>{
      input.value=''; output.textContent='';
    });

    // タブ切替
    const tabFormat = $('#tabFormat');
    const tabBuilder = $('#tabBuilder');
    const builder = $('#builder');
    if (tabFormat && tabBuilder && builder) {
      tabFormat.addEventListener('click', () => { builder.style.display = 'none'; window.scrollTo({top:0,behavior:'smooth'}); });
      tabBuilder.addEventListener('click', () => { builder.style.display = 'block'; builder.scrollIntoView({behavior:'smooth'}); });
    }

    // ====== ビルダー（＋で行追加） ======
    const colsGrid = $('#colsGrid');
    const condsGrid = $('#condsGrid');
    const addColBtn = $('#addCol');
    const addCondBtn = $('#addCond');
    const clearBuilderBtn = $('#b_clear');

    function mkDelBtn(){
      const btn = document.createElement('button');
      btn.className = 'btn small';
      btn.textContent = '－ 削除';
      btn.addEventListener('click', (e)=> {
        const row = e.target.closest('.grid > *') || e.target.parentElement;
        row?.remove();
      });
      return btn;
    }

    function addColRow(val=''){
      const wrap = document.createElement('div');
      wrap.style.display = 'grid';
      wrap.style.gridTemplateColumns = '1fr auto';
      wrap.style.gap = '10px';
      wrap.style.alignItems = 'center';
      const inp = document.createElement('input');
      inp.type = 'text';
      inp.placeholder = 'id  または  users.id AS user_id';
      inp.value = val;
      inp.addEventListener('keydown', (e)=>{ if(e.key==='Enter') { addColRow(); }});
      const del = mkDelBtn();
      wrap.appendChild(inp);
      wrap.appendChild(del);
      colsGrid.appendChild(wrap);
      inp.focus();
    }

    function addCondRow({field='',op='=',value=''}={}){
      const wrap = document.createElement('div');
      wrap.style.display = 'grid';
      wrap.style.gridTemplateColumns = '1fr 140px 1fr auto';
      wrap.style.gap = '10px';
      wrap.style.alignItems = 'center';


      const f = document.createElement('input');
      f.type='text'; f.placeholder='フィールド（例：created_at）'; f.value=field;

      const o = document.createElement('select');
      ['=','!=','>','<','>=','<=','LIKE','IN','IS NULL','IS NOT NULL'].forEach(v=>{
        const opt=document.createElement('option'); opt.value=v; opt.textContent=v; o.appendChild(opt);
      });
      o.value = op;

      const v = document.createElement('input');
      v.type='text'; v.placeholder="値（例：'2025-01-01'  /  ('A','B')）"; v.value=value;

      // Enterで次行を追加（値欄）
      v.addEventListener('keydown',(e)=>{ if(e.key==='Enter'){ addCondRow(); } });

      const del = mkDelBtn();

      wrap.appendChild(f); wrap.appendChild(o); wrap.appendChild(v); wrap.appendChild(del);
      condsGrid.appendChild(wrap);
      f.focus();
    }

    addColBtn.addEventListener('click', ()=> addColRow());
    addCondBtn.addEventListener('click', ()=> addCondRow());
    clearBuilderBtn.addEventListener('click', ()=>{
      $('#b_table').value = '';
      $('#b_order').value = '';
      $('#b_limit').value = '';
      colsGrid.innerHTML = '';
      condsGrid.innerHTML = '';
      addColRow(); addCondRow();
    });

    // 初期行
    addColRow('*');
    addCondRow();

    // 生成 → 入力へ反映
    $('#b_make').addEventListener('click', ()=>{
      const table = ($('#b_table').value||'').trim();
      if(!table){ alert('テーブル名を入力してください'); return; }

      const cols = [...colsGrid.querySelectorAll('input[type="text"]')]
        .map(i=> (i.value||'').trim())
        .filter(Boolean);

      const conds = [...condsGrid.children].map(row=>{
        const [f,o,v] = row.querySelectorAll('input,select');
        const field = (f?.value||'').trim();
        const op = (o?.value||'').trim();
        let val = (v?.value||'').trim();

        if (!field) return '';
        // IN の最小補助：カンマ区切りっぽいが括弧が無ければ括弧で包む
        if (op === 'IN' && val && !/^\(.*\)$/.test(val)) {
          const parts = val.split(',').map(s=>s.trim()).filter(Boolean);
          if (parts.length > 1) { val = '(' + parts.join(', ') + ')'; }
        }
        // IS NULL 系は値を出さない
        if (op === 'IS NULL' || op === 'IS NOT NULL') return `${field} ${op}`;
        // 値が空なら無視
        if (!val) return '';
        return `${field} ${op} ${val}`;
      }).filter(Boolean);

      const colsSql = cols.length ? cols.join(', ') : '*';
      let sql = `SELECT ${colsSql}\nFROM ${table}`;
      if (conds.length) sql += `\nWHERE ${conds.join('\n  AND ')}`;
      const order = ($('#b_order').value||'').trim();
      const limit = ($('#b_limit').value||'').trim();
      if (order) sql += `\nORDER BY ${order}`;
      if (limit) sql += `\nLIMIT ${limit}`;

      input.value = sql;
      formatNow();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // 初期表示：サンプル整形
    formatNow();
  </script>
</body>
</html>
